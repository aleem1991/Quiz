<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cyber Quest: Phishing Awareness</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <style>
    :root {
      --primary: #00d9ff;
      --primary-dark: #00a6cc;
      --secondary: #ff2a6d;
      --secondary-dark: #cc0044;
      --accent: #05d9e8;
      --accent-dark: #00a6b3;
      --light: rgba(255, 255, 255, 0.9);
      --dark: #0c0e1c;
      --success: #00ff9d;
      --warning: #ffde59;
      --danger: #ff2a6d;
      --round1: #7122fa;
      --round2: #ff2a6d;
      --round3: #00ff9d;
      --glass-bg: rgba(16, 18, 37, 0.7);
      --glass-border: rgba(0, 217, 255, 0.3);
      --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.4);
      --neon-glow: 0 0 10px var(--primary), 0 0 20px var(--primary), 0 0 30px var(--primary);
      
      /* Light mode variables */
      --bg-light: #f0f2f5;
      --text-light: #333;
      --card-light: rgba(255, 255, 255, 0.9);
      --border-light: rgba(0, 0, 0, 0.1);
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    /* Enable scrolling for the entire page */
    html, body {
      scroll-behavior: smooth;
      overflow-x: auto;
      overflow-y: auto;
      min-height: 100vh;
      width: 100%;
    }
    
    body {
      background: linear-gradient(135deg, #0c0e1c 0%, #1a1f38 50%, #0c0e1c 100%);
      color: white;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      position: relative;
      width: 100%;
      transition: background 0.5s ease, color 0.5s ease;
    }
    
    body.light-mode {
      background: linear-gradient(135deg, #f0f2f5 0%, #d9e1e8 50%, #f0f2f5 100%);
      color: var(--text-light);
    }
    
    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(0, 217, 255, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(255, 42, 109, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 50% 50%, rgba(113, 34, 250, 0.05) 0%, transparent 50%);
      pointer-events: none;
    }
    
    body.light-mode::before {
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(0, 217, 255, 0.05) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(255, 42, 109, 0.05) 0%, transparent 20%),
        radial-gradient(circle at 50% 50%, rgba(113, 34, 250, 0.02) 0%, transparent 50%);
    }
    
    .quiz-container {
      width: 95%;
      height: 95%;
      max-width: 1600px;
      display: flex;
      gap: 20px;
      z-index: 1;
      overflow: auto; /* Enable scrolling if content overflows */
    }
    
    .main-content {
      flex: 3;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }
    
    .leaderboard {
      flex: 1;
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: 20px;
      border: 1px solid var(--glass-border);
      box-shadow: var(--glass-shadow);
      padding: 25px;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
      min-height: 0;
    }
    
    body.light-mode .leaderboard {
      background: var(--card-light);
      border: 1px solid var(--border-light);
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
    }
    
    .leaderboard::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(0, 217, 255, 0.1) 0%, rgba(255, 42, 109, 0.1) 100%);
      z-index: -1;
    }
    
    body.light-mode .leaderboard::before {
      background: linear-gradient(135deg, rgba(0, 217, 255, 0.05) 0%, rgba(255, 42, 109, 0.05) 100%);
    }
    
    .leaderboard h2 {
      color: white;
      text-align: center;
      margin-bottom: 20px;
      font-size: 1.8rem;
      text-shadow: 0 0 10px var(--primary);
    }
    
    body.light-mode .leaderboard h2 {
      color: var(--text-light);
      text-shadow: none;
    }
    
    .leaderboard-list {
      flex: 1;
      overflow-y: auto;
      max-height: 100%;
    }
    
    .leaderboard-item {
      display: flex;
      justify-content: space-between;
      background: rgba(255, 255, 255, 0.1);
      margin-bottom: 10px;
      padding: 12px 15px;
      border-radius: 10px;
      color: white;
      font-weight: 500;
      transition: all 0.3s;
      border: 1px solid transparent;
    }
    
    body.light-mode .leaderboard-item {
      background: rgba(0, 0, 0, 0.05);
      color: var(--text-light);
    }
    
    .leaderboard-item:hover {
      transform: translateX(5px);
      border-color: var(--primary);
      box-shadow: 0 0 10px rgba(0, 217, 255, 0.3);
    }
    
    .leaderboard-item.current-player {
      background: rgba(0, 217, 255, 0.2);
      box-shadow: 0 0 15px rgba(0, 217, 255, 0.5);
      border-color: var(--primary);
    }
    
    body.light-mode .leaderboard-item.current-player {
      background: rgba(0, 217, 255, 0.1);
    }
    
    .leaderboard-item .rank {
      font-weight: bold;
      margin-right: 10px;
      min-width: 30px;
      color: var(--accent);
    }
    
    .leaderboard-item .name {
      flex: 1;
      text-align: left;
    }
    
    .leaderboard-item .score {
      font-weight: bold;
      color: var(--accent);
      min-width: 50px;
      text-align: right;
    }
    
    .reset-btn {
      background: var(--secondary);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 10px;
      margin-top: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 0 10px rgba(255, 42, 109, 0.3);
    }
    
    .reset-btn:hover {
      background: var(--secondary-dark);
      transform: translateY(-2px);
      box-shadow: 0 0 15px rgba(255, 42, 109, 0.5);
    }
    
    .glass-card {
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: 20px;
      border: 1px solid var(--glass-border);
      box-shadow: var(--glass-shadow);
      padding: 25px;
      flex: 1;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
      min-height: 0;
    }
    
    body.light-mode .glass-card {
      background: var(--card-light);
      border: 1px solid var(--border-light);
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
    }
    
    .glass-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(0, 217, 255, 0.1) 0%, rgba(255, 42, 109, 0.1) 100%);
      z-index: -1;
    }
    
    body.light-mode .glass-card::before {
      background: linear-gradient(135deg, rgba(0, 217, 255, 0.05) 0%, rgba(255, 42, 109, 0.05) 100%);
    }
    
    .screen {
      display: none;
      opacity: 0;
      transition: opacity 0.5s ease;
      flex-direction: column;
      height: 100%;
      min-height: 0;
    }
    
    .screen.active {
      display: flex;
      opacity: 1;
      animation: fadeIn 0.5s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    h1, h2, h3 {
      color: white;
      margin-bottom: 15px;
      text-shadow: 0 0 10px var(--primary);
    }
    
    body.light-mode h1,
    body.light-mode h2,
    body.light-mode h3 {
      color: var(--text-light);
      text-shadow: none;
    }
    
    h1 {
      font-size: 2.5rem;
      text-align: center;
    }
    
    h2 {
      font-size: 1.8rem;
    }
    
    p {
      margin-bottom: 10px;
      line-height: 1.6;
      color: var(--light);
    }
    
    body.light-mode p {
      color: var(--text-light);
    }
    
    .header {
      text-align: center;
      margin-bottom: 20px;
    }
    
    .header-icon {
      font-size: 4rem;
      margin-bottom: 15px;
      color: white;
      text-shadow: var(--neon-glow);
      animation: pulse 2s infinite;
    }
    
    body.light-mode .header-icon {
      color: var(--primary);
      text-shadow: 0 0 10px rgba(0, 217, 255, 0.5);
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    
    .input-container {
      margin: 20px 0;
      text-align: center;
    }
    
    .input-group {
      margin-bottom: 15px;
      text-align: left;
      width: 80%;
      margin-left: auto;
      margin-right: auto;
    }
    
    .input-group label {
      display: block;
      margin-bottom: 5px;
      color: var(--light);
      font-weight: 500;
    }
    
    body.light-mode .input-group label {
      color: var(--text-light);
    }
    
    input {
      padding: 12px;
      font-size: 16px;
      width: 100%;
      border: 2px solid rgba(0, 217, 255, 0.3);
      border-radius: 10px;
      transition: all 0.3s;
      background: rgba(0, 0, 0, 0.3);
      color: white;
    }
    
    body.light-mode input {
      background: white;
      color: var(--text-light);
      border: 2px solid rgba(0, 0, 0, 0.2);
    }
    
    input::placeholder {
      color: rgba(255, 255, 255, 0.7);
    }
    
    body.light-mode input::placeholder {
      color: rgba(0, 0, 0, 0.5);
    }
    
    input:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 10px rgba(0, 217, 255, 0.5);
    }
    
    body.light-mode input:focus {
      box-shadow: 0 0 10px rgba(0, 217, 255, 0.3);
    }
    
    .input-error {
      color: var(--danger);
      font-size: 0.9rem;
      margin-top: 5px;
      display: none;
    }
    
    button {
      border: none;
      padding: 12px 24px;
      margin: 8px 5px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .btn-primary {
      background: var(--primary);
      color: var(--dark);
    }
    
    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0, 217, 255, 0.4);
    }
    
    .btn-secondary {
      background: var(--secondary);
      color: white;
    }
    
    .btn-secondary:hover {
      background: var(--secondary-dark);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 42, 109, 0.4);
    }
    
    .btn-accent {
      background: var(--accent);
      color: var(--dark);
    }
    
    .btn-accent:hover {
      background: var(--accent-dark);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(5, 217, 232, 0.4);
    }
    
    .round-info {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
      gap: 15px;
    }
    
    .round-card {
      flex: 1;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 15px;
      padding: 20px 15px;
      transition: all 0.3s;
      text-align: center;
      border-top: 5px solid;
      color: white;
      position: relative;
      overflow: hidden;
    }
    
    body.light-mode .round-card {
      background: rgba(255, 255, 255, 0.7);
      color: var(--text-light);
    }
    
    .round-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(0, 217, 255, 0.1) 0%, rgba(255, 42, 109, 0.1) 100%);
      z-index: -1;
    }
    
    body.light-mode .round-card::before {
      background: linear-gradient(135deg, rgba(0, 217, 255, 0.05) 0%, rgba(255, 42, 109, 0.05) 100%);
    }
    
    .round-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    }
    
    .round-card.round1 {
      border-color: var(--round1);
    }
    
    .round-card.round2 {
      border-color: var(--round2);
    }
    
    .round-card.round3 {
      border-color: var(--round3);
    }
    
    .round-card h3 {
      margin-bottom: 10px;
      font-size: 1.3rem;
    }
    
    .round-card p {
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.9rem;
    }
    
    body.light-mode .round-card p {
      color: rgba(0, 0, 0, 0.7);
    }
    
    .round-indicator {
      display: flex;
      justify-content: center;
      margin: 15px 0;
    }
    
    .round-dot {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      margin: 0 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: white;
      transition: all 0.3s;
      border: 2px solid transparent;
    }
    
    body.light-mode .round-dot {
      background: rgba(0, 0, 0, 0.1);
      color: var(--text-light);
    }
    
    .round-dot.active {
      transform: scale(1.2);
      border-color: var(--primary);
      box-shadow: 0 0 10px var(--primary);
    }
    
    .round-dot.round1.active {
      background: var(--round1);
    }
    
    .round-dot.round2.active {
      background: var(--round2);
    }
    
    .round-dot.round3.active {
      background: var(--round3);
    }
    
    .round-dot.completed {
      background: var(--success);
    }
    
    .quiz-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(0, 217, 255, 0.3);
    }
    
    body.light-mode .quiz-header {
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    .quiz-header div {
      font-weight: 600;
      color: white;
      font-size: 1rem;
    }
    
    body.light-mode .quiz-header div {
      color: var(--text-light);
    }
    
    .progress-container {
      margin: 15px 0;
    }
    
    .progress-bar {
      height: 8px;
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: 5px;
      margin: 12px 0;
      overflow: hidden;
    }
    
    body.light-mode .progress-bar {
      background-color: rgba(0, 0, 0, 0.1);
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      border-radius: 5px;
      transition: width 0.5s ease;
      box-shadow: 0 0 10px var(--primary);
    }
    
    .question-container {
      margin: 20px 0;
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }
    
    #question-text {
      font-size: 1.4rem;
      margin-bottom: 20px;
      line-height: 1.5;
      color: white;
    }
    
    body.light-mode #question-text {
      color: var(--text-light);
    }
    
    /* Updated options styling - more compact */
    .options-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-bottom: 15px;
      flex: 1;
      overflow-y: auto;
      padding: 3px;
    }
    
    .option-btn {
      padding: 12px;
      background: rgba(0, 0, 0, 0.3);
      border: 2px solid transparent;
      border-radius: 12px;
      text-align: left;
      transition: all 0.3s;
      font-size: 0.95rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      color: white;
      height:100px;
      
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
      position: relative;
      overflow: hidden;
    }
    
    body.light-mode .option-btn {
      background: rgba(255, 255, 255, 0.7);
      color: var(--text-light);
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
    }
    
    .option-btn:hover {
      background: rgba(0, 217, 255, 0.2);
      border-color: var(--primary);
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0, 217, 255, 0.3);
    }
    
    body.light-mode .option-btn:hover {
      background: rgba(0, 217, 255, 0.1);
    }
    
    .option-btn:disabled {
      cursor: not-allowed;
      opacity: 0.7;
    }
    
    /* Visual feedback for keyboard selection */
    .option-btn.keyboard-selected {
      background: rgba(0, 217, 255, 0.4);
      border-color: var(--primary);
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(0, 217, 255, 0.7);
    }
    
    /* Image-only option styling - compact */
    .option-btn.image-only {
      padding: 0;
      display: inline-block;
      justify-content: center;
      align-items: center;
      text-align: center;
      height: 100px;
      min-height: 100px;
      width:100px;
    }
    
    .option-img {
      width: 100%;
      height: auto;
      max-width: 100%;
      border-radius: inherit;
      object-fit: contain;
      padding: 0;
      margin: 0;
      display: block;
    }
    
    /* For text options, maintain the compact min-height */
    .option-btn:not(.image-only) {
      min-height: 60px;
    }
    
    .feedback {
      margin: 15px 0;
      padding: 12px;
      border-radius: 10px;
      font-weight: 600;
      animation: popIn 0.5s;
      color: white;
      border: 1px solid;
    }
    
    @keyframes popIn {
      0% { transform: scale(0.8); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
    
    .correct {
      background-color: rgba(0, 255, 157, 0.2);
      border-color: var(--success);
    }
    
    body.light-mode .correct {
      background-color: rgba(0, 255, 157, 0.1);
    }
    
    .incorrect {
      background-color: rgba(255, 42, 109, 0.2);
      border-color: var(--danger);
    }
    
    body.light-mode .incorrect {
      background-color: rgba(255, 42, 109, 0.1);
    }
    
    .quiz-footer {
      margin-top: 15px;
      text-align: center;
    }
    
    .round-complete-content {
      padding: 20px;
      text-align: center;
      display: flex;
      flex-direction: column;
      height: 100%;
      justify-content: center;
    }
    
    .round-badge {
      display: inline-block;
      background: var(--secondary);
      color: white;
      padding: 8px 20px;
      border-radius: 20px;
      margin-bottom: 15px;
      font-weight: 600;
      box-shadow: 0 0 10px rgba(255, 42, 109, 0.5);
    }
    
    .round-score {
      margin: 20px 0;
    }
    
    .score-circle {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: var(--primary);
      color: var(--dark);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin: 0 auto 15px;
      font-size: 1.6rem;
      font-weight: bold;
      animation: pulse 2s infinite;
      box-shadow: 0 0 20px var(--primary);
    }
    
    .round-feedback {
      margin: 15px 0;
      padding: 12px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      font-size: 1.1rem;
      color: white;
      border: 1px solid var(--primary);
    }
    
    body.light-mode .round-feedback {
      background: rgba(255, 255, 255, 0.7);
      color: var(--text-light);
    }
    
    .end-content {
      padding: 20px;
      text-align: center;
      display: flex;
      flex-direction: column;
      height: 100%;
      justify-content: center;
    }
    
    .final-score {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 30px;
      margin: 20px 0;
    }
    
    .trophy-container {
      flex: 1;
      max-width: 150px;
    }
    
    .trophy {
      font-size: 6rem;
      animation: bounce 1s infinite;
      color: gold;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }
    
    .score-breakdown {
      flex: 1;
      text-align: left;
    }
    
    .score-breakdown h3 {
      color: white;
      margin-bottom: 12px;
      font-size: 1.6rem;
    }
    
    body.light-mode .score-breakdown h3 {
      color: var(--text-light);
    }
    
    .round-scores p {
      margin: 8px 0;
      font-size: 1rem;
    }
    
    .celebration {
      margin: 15px 0;
      font-size: 1.3rem;
      font-weight: bold;
      animation: pop 1s ease-in-out infinite;
      color: white;
    }
    
    body.light-mode .celebration {
      color: var(--text-light);
    }
    
    @keyframes pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    
    .game-over {
      background: linear-gradient(135deg, var(--danger), #cc0044);
      color: white;
      padding: 30px;
      text-align: center;
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(255, 42, 109, 0.5);
      margin: auto;
      max-width: 90%;
    }
    
    .game-over h2 {
      color: white;
      margin-bottom: 15px;
    }
    
    .empty-leaderboard {
      text-align: center;
      color: rgba(255, 255, 255, 0.7);
      font-style: italic;
      margin-top: 30px;
    }
    
    body.light-mode .empty-leaderboard {
      color: rgba(0, 0, 0, 0.5);
    }
    
    .player-ranking {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
      text-align: center;
      border: 1px solid var(--primary);
    }
    
    body.light-mode .player-ranking {
      background: rgba(255, 255, 255, 0.7);
    }
    
    .player-ranking h3 {
      margin-bottom: 8px;
    }
    
    .ranking-badge {
      font-size: 1.8rem;
      font-weight: bold;
      margin: 8px 0;
      color: var(--accent);
    }
    
    /* Character Styles */
    .character-container {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .character-image {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      margin-right: 15px;
      border: 3px solid var(--primary);
      box-shadow: 0 0 15px var(--primary);
      background: linear-gradient(135deg, var(--primary), var(--accent));
    }
    
    .character-speech {
      flex: 1;
      background: rgba(0, 0, 0, 0.3);
      padding: 12px 15px;
      border-radius: 15px;
      position: relative;
      animation: fadeIn 0.5s ease;
      border: 1px solid var(--primary);
    }
    
    body.light-mode .character-speech {
      background: rgba(255, 255, 255, 0.7);
    }
    
    .character-speech:after {
      content: '';
      position: absolute;
      left: -10px;
      top: 50%;
      transform: translateY(-50%);
      width: 0;
      height: 0;
      border-top: 10px solid transparent;
      border-bottom: 10px solid transparent;
      border-right: 10px solid rgba(0, 217, 255, 0.5);
    }
    
    body.light-mode .character-speech:after {
      border-right: 10px solid rgba(0, 217, 255, 0.3);
    }
    
    .character-speech p {
      margin: 0;
      font-style: italic;
    }
    
    .character-name {
      font-weight: bold;
      color: var(--accent);
      margin-bottom: 5px;
      text-shadow: 0 0 5px var(--accent);
    }
    
    body.light-mode .character-name {
      text-shadow: none;
    }
    
    /* Techy Elements */
    .tech-grid {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        linear-gradient(rgba(0, 217, 255, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 217, 255, 0.1) 1px, transparent 1px);
      background-size: 20px 20px;
      pointer-events: none;
      z-index: -1;
    }
    
    body.light-mode .tech-grid {
      background-image: 
        linear-gradient(rgba(0, 217, 255, 0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 217, 255, 0.05) 1px, transparent 1px);
    }
    
    .floating-tech {
      position: absolute;
      width: 100px;
      height: 100px;
      background: rgba(0, 217, 255, 0.1);
      border-radius: 50%;
      filter: blur(20px);
      animation: float 6s ease-in-out infinite;
      z-index: -1;
    }
    
    body.light-mode .floating-tech {
      background: rgba(0, 217, 255, 0.05);
    }
    
    .floating-tech:nth-child(1) {
      top: 10%;
      left: 10%;
      animation-delay: 0s;
    }
    
    .floating-tech:nth-child(2) {
      top: 60%;
      left: 80%;
      animation-delay: 2s;
    }
    
    .floating-tech:nth-child(3) {
      top: 30%;
      left: 70%;
      animation-delay: 4s;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(180deg); }
    }
    
    /* Controls Section */
    .controls-container {
      position: absolute;
      top: 20px;
      right: 20px;
      display: flex;
      gap: 10px;
      z-index: 10;
    }
    
    .control-btn {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--glass-border);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
      color: white;
      font-size: 1.2rem;
    }
    
    body.light-mode .control-btn {
      background: rgba(255, 255, 255, 0.7);
      color: var(--text-light);
    }
    
    .control-btn:hover {
      transform: scale(1.1);
      background: var(--primary);
      color: var(--dark);
    }
    
    /* Achievement Badges - UPDATED STYLES */
    .achievement-badge {
      display: inline-block;
      background: linear-gradient(135deg, #00d4ff, #0066ff);
      color: white;
      padding: 10px 18px;
      border-radius: 25px;
      font-weight: 600;
      margin: 8px;
      display: inline-block;
      box-shadow: 0 0 15px rgba(0, 217, 255, 0.6);
      animation: achievementPopIn 0.6s ease;
    }
    
    @keyframes achievementPopIn {
      0% { transform: scale(0); opacity: 0; }
      60% { transform: scale(1.3); opacity: 1; }
      100% { transform: scale(1); }
    }
    
    .achievements-container {
      margin: 20px 0;
      text-align: center;
    }
    
    /* Confetti Canvas - UPDATED STYLES */
    #confetti-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
    }
    
    /* Quiz ended screen */
    .quiz-ended-screen {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      height: 100%;
    }
    
    .quiz-ended-content {
      background: rgba(255, 42, 109, 0.8);
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(255, 42, 109, 0.5);
      max-width: 500px;
      width: 90%;
    }
    
    @media (max-width: 1024px) {
      .quiz-container {
        flex-direction: column;
        height: 95%;
      }
      
      .leaderboard {
        order: -1;
        margin-bottom: 15px;
        max-height: 200px;
      }
      
      .main-content {
        min-height: 0;
        flex: 1;
      }
    }
    
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      .quiz-container {
        width: 100%;
        height: 100%;
      }
      
      .glass-card {
        padding: 15px;
      }
      
      h1 {
        font-size: 2rem;
      }
      
      h2 {
        font-size: 1.5rem;
      }
      
      .round-info {
        flex-direction: column;
      }
      
      .quiz-header {
        flex-direction: column;
        gap: 8px;
      }
      
      .final-score {
        flex-direction: column;
        gap: 15px;
      }
      
      .score-breakdown {
        text-align: center;
      }
      
      .trophy {
        font-size: 4rem;
      }
      
      .options-grid {
        grid-template-columns: 1fr;
        gap: 6px;
      }
      
      .option-btn {
        flex-direction: column;
        text-align: center;
        min-height: 50px;
        padding: 10px;
      }
      
      .option-btn.image-only {
        height: 80px;
        min-height: 80px;
      }
      
      .character-container {
        flex-direction: column;
        text-align: center;
      }
      
      .character-image {
        margin-right: 0;
        margin-bottom: 10px;
      }
      
      .character-speech:after {
        left: 50%;
        top: -10px;
        transform: translateX(-50%);
        border-left: 10px solid transparent;
        border-right: 10px solid transparent;
        border-bottom: 10px solid rgba(0, 217, 255, 0.5);
        border-top: 0;
      }
      
      body.light-mode .character-speech:after {
        border-bottom: 10px solid rgba(0, 217, 255, 0.3);
      }
    }
  </style>
</head>
<body>
  <!-- Confetti Canvas -->
  <canvas id="confetti-canvas"></canvas>
  
  <!-- Techy Background Elements -->
  <div class="tech-grid"></div>
  <div class="floating-tech"></div>
  <div class="floating-tech"></div>
  <div class="floating-tech"></div>
  
  <!-- Controls -->
  <div class="controls-container">
    <div class="control-btn" id="theme-toggle" title="Toggle Theme">
      <i class="fas fa-moon"></i>
    </div>
    <div class="control-btn" id="sound-toggle" title="Toggle Sound">
      <i class="fas fa-volume-up"></i>
    </div>
    <div class="control-btn" id="music-toggle" title="Toggle Music">
      <i class="fas fa-music"></i>
    </div>
  </div>
  
  <div class="quiz-container">
    <div class="main-content">
      <!-- Start Screen (with Leaderboard) -->
      <div id="start-screen" class="screen active glass-card">
        <div class="header">
          <div class="header-icon">🔐</div>
          <h1>Cyber Quest: Phishing Awareness</h1>
          <p>Embark on a journey through the digital realm to test your ability to spot phishing attempts!</p>
        </div>
        
        <div class="character-container">
          <img src="https://i.pinimg.com/originals/3b/e2/f4/3be2f445535301ebc8d739576ce8b36d.gif" alt="Cyber Guardian" class="character-image">
          <div class="character-speech">
            <div class="character-name">Nexus Guardian</div>
            <p>Welcome, digital warrior! I'll be your guide through this cybersecurity training. Let's start by getting to know you better.</p>
          </div>
        </div>
        
        <div class="input-container">
          <div class="input-group">
            <label for="player-name">Your Codename</label>
            <input type="text" id="player-name" placeholder="Enter your codename" />
            <div class="input-error" id="name-error">Please enter your codename</div>
          </div>
          <div class="input-group">
            <label for="player-age">Digital Age (15-100)</label>
            <input type="number" id="player-age" placeholder="Enter your digital age" min="15" max="100" />
            <div class="input-error" id="age-error">Age must be between 15 and 100</div>
          </div>
          <div class="input-group">
            <label for="player-phone">Secure Contact (10-digit)</label>
            <input type="tel" id="player-phone" placeholder="Enter your phone number" />
            <div class="input-error" id="phone-error">Please enter a valid 10-digit phone number</div>
          </div>
          <button onclick="startQuiz()" class="btn-primary">Initiate Mission</button>
        </div>
        <div class="round-info">
          <div class="round-card round1">
            <h3>Data Stream Analysis</h3>
            <p>Identify phishing emails and suspicious data packets</p>
          </div>
          <div class="round-card round2">
            <h3>Firewall Penetration</h3>
            <p>Spot fake websites and malicious code injections</p>
          </div>
          <div class="round-card round3">
            <h3>Security Protocols</h3>
            <p>Test your security knowledge and encryption practices</p>
          </div>
        </div>
      </div>

      <!-- Round Intro Screen -->
      <div id="round-intro-screen" class="screen glass-card">
        <div class="character-container">
          <img id="round-intro-character-image" src="https://i.pinimg.com/originals/3b/e2/f4/3be2f445535301ebc8d739576ce8b36d.gif" alt="Cyber Guardian" class="character-image">
          <div class="character-speech" id="round-intro-speech">
            <div class="character-name">Nexus Guardian</div>
            <p id="round-intro-message">Ready for the first challenge? Let's test your email phishing detection skills!</p>
          </div>
        </div>
        
        <div class="round-indicator">
          <div class="round-dot round1 active">1</div>
          <div class="round-dot round2">2</div>
          <div class="round-dot round3">3</div>
        </div>
        <div class="round-intro-content">
          <h2 id="round-title"></h2>
          <p id="round-description"></p>
          <div class="round-progress">
            <div class="progress-bar">
              <div class="progress-fill" id="overall-progress"></div>
            </div>
            <p>System Sync: <span id="progress-text">0%</span></p>
          </div>
          <button onclick="startRound()" class="btn-primary">Access Data Stream</button>
        </div>
      </div>

      <!-- Quiz Screen -->
      <div id="quiz-screen" class="screen glass-card">
        <div class="character-container">
          <img id="quiz-character-image" src="https://i.pinimg.com/originals/3b/e2/f4/3be2f445535301ebc8d739576ce8b36d.gif" alt="Cyber Guardian" class="character-image">
          <div class="character-speech" id="quiz-speech">
            <div class="character-name">Nexus Guardian</div>
            <p id="quiz-message">Analyze each data packet carefully and select the correct response. I'll provide tactical feedback!</p>
          </div>
        </div>
        
        <div class="quiz-header">
          <div class="round-indicator">Firewall Level <span id="current-round">1</span> of 3</div>
          <div class="question-counter">Data Packet <span id="current-question">1</span> of 5</div>
          <div class="score-display">Security Score: <span id="current-score">0</span></div>
        </div>
        
        <div class="progress-container">
          <div class="progress-bar">
            <div class="progress-fill" id="question-progress"></div>
          </div>
        </div>
        
        <div class="question-container">
          <h2 id="question-text"></h2>
          <div id="options" class="options-grid"></div>
          <div id="feedback" class="feedback"></div>
        </div>
        
        <div class="quiz-footer">
          <button onclick="nextQuestion()" class="btn-secondary" id="next-btn">Analyze Next Packet</button>
        </div>
      </div>

      <!-- Round Complete Screen -->
      <div id="round-complete-screen" class="screen glass-card">
        <div class="character-container">
          <img id="round-complete-character-image" src="https://i.pinimg.com/originals/3b/e2/f4/3be2f445535301ebc8d739576ce8b36d.gif" alt="Cyber Guardian" class="character-image">
          <div class="character-speech" id="round-complete-speech">
            <div class="character-name">Nexus Guardian</div>
            <p id="round-complete-message">Firewall level complete! Let's analyze your performance.</p>
          </div>
        </div>
        
        <div class="round-complete-content">
          <div class="round-badge">Firewall Level <span id="completed-round">1</span> Secured!</div>
          <h2 id="round-result-title"></h2>
          <div class="round-score">
            <div class="score-circle">
              <span id="round-score-value">0</span>/5
            </div>
            <p>Data packets analyzed correctly</p>
          </div>
          <div id="round-feedback" class="round-feedback"></div>
          <div id="achievements-earned" class="achievements-container"></div>
          <div id="auto-proceed-message" class="round-feedback" style="display: none;">
            <p>Proceeding to next level in <span id="countdown">3</span> seconds...</p>
          </div>
        </div>
      </div>

      <!-- Game Over Screen -->
      <div id="game-over-screen" class="screen glass-card">
        <div class="character-container">
          <img src="https://i.pinimg.com/originals/3b/e2/f4/3be2f445535301ebc8d739576ce8b36d.gif" alt="Cyber Guardian" class="character-image">
          <div class="character-speech">
            <div class="character-name">Nexus Guardian</div>
            <p>Firewall breach detected! Let's recalibrate and try again with enhanced protocols.</p>
          </div>
        </div>
        
        <div class="game-over">
          <h2>System Failure - Recalibrate!</h2>
          <p>Your security score was insufficient to proceed to the next firewall level.</p>
          <p>Final integrity score: <span id="final-score-go">0</span>/15</p>
          <button onclick="restartQuiz()" class="btn-accent">Reinitialize System</button>
        </div>
      </div>

      <!-- End Screen -->
      <div id="end-screen" class="screen glass-card">
        <div class="character-container">
          <img src="https://i.pinimg.com/originals/3b/e2/f4/3be2f445535301ebc8d739576ce8b36d.gif" alt="Cyber Guardian" class="character-image">
          <div class="character-speech">
            <div class="character-name">Nexus Guardian</div>
            <p>Excellent work, agent! You've successfully navigated all firewall levels. The digital realm is safer thanks to your efforts!</p>
          </div>
        </div>
        
        <div class="end-content">
          <h2 id="congrats-message"></h2>
          <div class="final-score">
            <div class="trophy-container">
              <div class="trophy" id="trophy">🏆</div>
            </div>
            <div class="score-breakdown">
              <h3>Final Integrity Score: <span id="final-score-value">0</span>/15</h3>
              <div class="round-scores">
                <p>Level 1: <span id="round1-score">0</span>/5</p>
                <p>Level 2: <span id="round2-score">0</span>/5</p>
                <p>Level 3: <span id="round3-score">0</span>/5</p>
              </div>
            </div>
          </div>
          <div id="player-ranking" class="player-ranking">
            <h3>Agent Ranking</h3>
            <div class="ranking-badge" id="ranking-badge">#1</div>
            <p>Out of <span id="total-players">0</span> cyber agents</p>
          </div>
          <div id="achievements-container" class="achievements-container"></div>
          <div id="celebration" class="celebration"></div>
          <button onclick="restartQuiz()" class="btn-primary">Begin New Mission</button>
        </div>
      </div>

      <!-- Quiz Ended Screen -->
      <div id="quiz-ended-screen" class="screen glass-card">
        <div class="quiz-ended-screen">
          <div class="quiz-ended-content">
            <h2>⚠️ Quiz Terminated</h2>
            <p>You have exited fullscreen mode. The quiz has ended.</p>
            <button onclick="restartQuiz()" class="btn-accent">Return to Start</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Leaderboard (only visible on start screen) -->
    <div class="leaderboard" id="leaderboard">
      <h2><i class="fas fa-trophy"></i> Agent Rankings</h2>
      <div class="leaderboard-list" id="leaderboard-list">
        <!-- Leaderboard items will be populated here -->
      </div>
      <button class="reset-btn" onclick="resetLeaderboard()"><i class="fas fa-trash-alt"></i> Purge Data</button>
    </div>
  </div>

  <!-- Audio Elements -->
  <audio id="correct-sound" preload="auto">
    <source src="correct.mp3" type="audio/mpeg">
  </audio>
  <audio id="incorrect-sound" preload="auto">
    <source src="incorrect.mp3" type="audio/mpeg">
  </audio>
  <audio id="level-complete-sound" preload="auto">
    <source src="level-complete-sound.mp3" type="audio/mpeg">
  </audio>
  <audio id="game-complete-sound" preload="auto">
    <source src="Victory Sound Effect.mp3" type="audio/mpeg">
  </audio>
  <audio id="game-over-sound" preload="auto">
    <source src="game_over.mp3" type="audio/mpeg">
  </audio>
  <audio id="background-music" loop preload="auto">
    <source src="music.mp3" type="audio/mpeg">
  </audio>

  <script>
    // Game state variables
    let playerName = "";
    let playerAge = "";
    let playerPhone = "";
    let currentRound = 0;
    let currentQuestionIndex = 0;
    let score = 0;
    let roundScores = [0, 0, 0];
    let leaderboard = JSON.parse(localStorage.getItem('phishingQuizLeaderboard')) || [];
    let countdownInterval;
    let userData = JSON.parse(localStorage.getItem('cyberQuestUserData')) || {};
    let achievements = JSON.parse(localStorage.getItem('cyberQuestAchievements')) || [];
    let soundEnabled = true;
    let musicEnabled = true;
    let startTime;
    let isInFullscreen = false;
    let answerLocked = false; // Prevents double-answering
    
    // Agent photos for each round
    const agentPhotos = {
      round1: "https://i.pinimg.com/originals/3b/e2/f4/3be2f445535301ebc8d739576ce8b36d.gif",
      round2: "https://i.pinimg.com/originals/3b/e2/f4/3be2f445535301ebc8d739576ce8b36d.gif", 
      round3: "https://i.pinimg.com/originals/3b/e2/f4/3be2f445535301ebc8d739576ce8b36d.gif"
    };
    
    // Achievement definitions
    const achievementDefinitions = [
      { id: "perfect_score", name: "Perfect Score", description: "Score 15/15 in the quiz", earned: false },
      { id: "fast_finisher", name: "Fast Finisher", description: "Complete all rounds in under 3 minutes", earned: false },
      { id: "first_round_master", name: "First Round Master", description: "Get a perfect score in Round 1", earned: false },
      { id: "cyber_expert", name: "Cyber Expert", description: "Complete all three rounds", earned: false },
      { id: "persistent_agent", name: "Persistent Agent", description: "Complete the quiz after failing once", earned: false }
    ];
    
    // Create a pool of 30 questions (10 per round)
    const questionPool = {
      round1: [
        {
          question: "You receive an email saying your account will be deleted unless you click a link immediately. What should you do?",
          options: [
            "Click the link quickly",
            "Ignore the email",
            "Verify the message by contacting the company directly",
            "Reply asking for more details"
          ],
          answer: 2,
          explanation: "Phishing messages often create urgency to trick users. It's safest to verify the message by contacting the company directly."
        },
        {
          question: "Which of the following is a common sign of a phishing email?",
          options: [
            "Professional grammar and spelling",
            "Email from a known contact",
            "Urgent request for personal information",
            "Secure HTTPS link"
          ],
          answer: 2,
          explanation: "Phishing emails often include urgent requests for personal info to pressure users into acting quickly."
        },
        {
          question: "An email says you've won a prize, but you never entered a contest. What should you do?",
          options: [
            "Reply asking for details",
            "Click to claim the prize",
            "Delete the email",
            "Forward it to your friends"
          ],
          answer: 2,
          explanation: "If you didn't enter a contest, it's likely a scam. Delete it."
        },
        {
          question: "Which email address looks suspicious?",
          options: [
            "support@amazon.com",
            "help@amaz0n.com",
            "info@amazon.co.uk",
            "service@amazon.in"
          ],
          answer: 1,
          explanation: "The email uses a zero instead of an 'o' — a common phishing trick."
        },
        {
          question: "Which of these logos is the real Instagram logo?",
          options: [
            { image: "option_1.png" },
            { image: "option_2.png" },
            { image: "option_3.png" },
            { image: "option_4.png" }
          ],
          answer: 0,
          explanation: "The Instagram logo uses a warm gradient of pink, purple, orange, and yellow with a clean white camera outline, giving it a modern, colorful, and instantly recognizable look."
        },
        {
          question: "You receive an email from 'PayPal Security' asking to verify your account. What should you check first?",
          options: [
            "The sender's email address",
            "The email subject line",
            "The email's formatting",
            "The links in the email"
          ],
          answer: 0,
          explanation: "Always verify the sender's email address to ensure it's from an official domain."
        },
        {
          question: "An email claims there's suspicious activity on your account and provides a link to 'secure your account'. What's the safest action?",
          options: [
            "Click the link immediately",
            "Log in directly to the official website",
            "Reply to the email for more information",
            "Forward the email to friends to warn them"
          ],
          answer: 1,
          explanation: "Never click links in suspicious emails. Always navigate directly to the official website."
        },
        {
          question: "What does 'spoofing' mean in the context of phishing?",
          options: [
            "Making fun of someone online",
            "Faking the sender information in an email",
            "Creating multiple email accounts",
            "Sending emails to wrong addresses"
          ],
          answer: 1,
          explanation: "Spoofing is when phishers fake the sender information to make emails appear legitimate."
        },
        {
          question: "You receive an email with an attachment from an unknown sender. What should you do?",
          options: [
            "Open it to see what it is",
            "Forward it to IT department",
            "Delete it without opening",
            "Reply asking what it is"
          ],
          answer: 2,
          explanation: "Never open attachments from unknown senders as they may contain malware."
        },
        {
          question: "Which of these is a red flag in an email?",
          options: [
            "Personalized greeting with your name",
            "Professional company logo",
            "Request for immediate action with consequences",
            "Contact information in the footer"
          ],
          answer: 2,
          explanation: "Phishing emails often create false urgency to pressure you into acting without thinking."
        }
      ],
      round2: [
        {
          question: "Which of these is most likely a phishing website?",
          options: [
            "https://www.google.com",
            "https://secure.bank.com",
            "http://login.bank-secure.com",
            "https://school.edu/login"
          ],
          answer: 2,
          explanation: "Phishing sites often use misleading URLs like 'bank-secure.com'."
        },
        {
          question: "What should you check before clicking a link in an email?",
          options: [
            "The actual URL behind the link",
            "The font used in the email",
            "The color of the link",
            "The sender's name"
          ],
          answer: 0,
          explanation: "Always check the actual URL to ensure it's legitimate."
        },
        {
          question: "You're on a website asking for login credentials. What indicates it might be fake?",
          options: [
            "The URL starts with HTTPS",
            "There are spelling errors on the page",
            "It has a privacy policy link",
            "It displays the company logo"
          ],
          answer: 1,
          explanation: "Spelling errors and poor design can indicate a fake website."
        },
        {
          question: "Which of these is the real Facebook logo?",
          options: [
            { image: "facebook_a.png" },
            { image: "facebook_b.png" },
            { image: "facebook_c.jpg" },
            { image: "facebook_d.jpg" }
          ],
          answer: 0,
          explanation: "Facebook's official logo is a white lowercase 'f' on a blue background."
        },
        {
          question: "What does a padlock icon in the address bar indicate?",
          options: [
            "The website is completely safe",
            "The connection is encrypted",
            "The website is legitimate",
            "The website has no malware"
          ],
          answer: 1,
          explanation: "A padlock only means the connection is encrypted, not that the website is safe or legitimate."
        },
        {
          question: "You're redirected to a login page that looks like your bank's website. How can you verify it's legitimate?",
          options: [
            "Check if the URL matches your bank's official website",
            "See if the page loads quickly",
            "Look for the bank's logo",
            "Check if the page has a modern design"
          ],
          answer: 0,
          explanation: "Always verify the URL matches the official website exactly."
        },
        {
          question: "What is 'typosquatting'?",
          options: [
            "Making typing mistakes in emails",
            "Registering domains with common misspellings",
            "Sending emails with typos",
            "Creating websites with poor spelling"
          ],
          answer: 1,
          explanation: "Typosquatting is registering domains with common misspellings to trick users."
        },
        {
          question: "A website asks for more personal information than usual. What should you do?",
          options: [
            "Provide the information",
            "Close the website immediately",
            "Check if the request makes sense for the service",
            "Ask friends if they provided the information"
          ],
          answer: 2,
          explanation: "Always question why a website needs certain information and whether it's appropriate."
        },
        {
          question: "Which URL looks most suspicious?",
          options: [
            "https://www.apple.com",
            "https://apple-id.secure.com",
            "https://support.apple.com",
            "https://www.apple.com/shop"
          ],
          answer: 1,
          explanation: "The domain 'secure.com' is not Apple's official domain, making it suspicious."
        },
        {
          question: "What should you do if you accidentally enter your password on a suspicious website?",
          options: [
            "Do nothing, it's probably fine",
            "Change your password immediately on the legitimate site",
            "Wait to see if anything happens",
            "Email the website to delete your information"
          ],
          answer: 1,
          explanation: "Change your password immediately on the legitimate website to protect your account."
        }
      ],
      round3: [
        {
          question: "Which of these is a safe practice online?",
          options: [
            "Using two-factor authentication",
            "Sharing passwords with friends",
            "Clicking unknown links",
            "Using the same password everywhere"
          ],
          answer: 0,
          explanation: "Two-factor authentication adds an extra layer of security."
        },
        {
          question: "What should you do if you suspect an email is phishing?",
          options: [
            "Forward it to your friends",
            "Reply asking for confirmation",
            "Click the link to check",
            "Report it to your IT department or teacher"
          ],
          answer: 3,
          explanation: "Reporting helps prevent others from falling for the scam."
        },
        {
          question: "Which of these is a good way to protect yourself from phishing?",
          options: [
            "Trust all messages from your school",
            "Use strong, unique passwords",
            "Disable antivirus software",
            "Open all emails quickly"
          ],
          answer: 1,
          explanation: "Strong, unique passwords help protect your accounts."
        },
        {
          question: "You get a message from 'admin@school.edu' asking for your login details. What should you do?",
          options: [
            "Send your login details",
            "Forward it to classmates",
            "Check with your teacher or school office",
            "Ignore the message"
          ],
          answer: 2,
          explanation: "Always verify such requests with your teacher or school office."
        },
        {
          question: "Which of these is the real Apple logo?",
          options: [
            { image: "apple_a.png" },
            { image: "apple_b.jpg" },
            { image: "apple_c.png" },
            { image: "apple_d.png" }
          ],
          answer: 0,
          explanation: "Apple's logo is a stylized apple with a bite taken out of it."
        },
        {
          question: "Why do phishing emails often contain spelling mistakes?",
          options: [
            "To bypass spam filters",
            "Because they are rushed",
            "To target less cautious users",
            "They are written by non-native speakers"
          ],
          answer: 2,
          explanation: "Mistakes help filter out cautious users — phishing targets those who overlook details."
        },
        {
          question: "What is 'smishing'?",
          options: [
            "Phishing via SMS/text messages",
            "A type of fishing technique",
            "Phishing using social media",
            "A secure messaging app"
          ],
          answer: 0,
          explanation: "Smishing is phishing conducted through SMS/text messages."
        },
        {
          question: "How can you verify if a website is legitimate?",
          options: [
            "Check for a privacy policy",
            "Look for customer reviews",
            "Verify the domain with official sources",
            "See if it has social media links"
          ],
          answer: 2,
          explanation: "The most reliable way is to verify the domain matches the official website."
        },
        {
          question: "What should you do if you receive a suspicious text message?",
          options: [
            "Reply 'STOP'",
            "Click any links to investigate",
            "Delete it and block the number",
            "Forward it to all your contacts"
          ],
          answer: 2,
          explanation: "Delete suspicious texts and block the number to protect yourself."
        },
        {
          question: "Which is NOT a recommended security practice?",
          options: [
            "Regularly updating software",
            "Using a password manager",
            "Sharing passwords with family members",
            "Enabling login notifications"
          ],
          answer: 2,
          explanation: "You should never share passwords, even with family members."
        }
      ]
    };

    // Initialize the game
    document.addEventListener('DOMContentLoaded', function() {
      updateLeaderboard();
      initializeAchievements();
      loadUserPreferences();
      
      // Set up control buttons
      document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
      document.getElementById('sound-toggle').addEventListener('click', toggleSound);
      document.getElementById('music-toggle').addEventListener('click', toggleMusic);
      
      // Set up input validation
      document.getElementById('player-age').addEventListener('input', validateAge);
      document.getElementById('player-phone').addEventListener('input', validatePhone);
      
      // Add keyboard event listener for Enter key and number keys
      document.addEventListener('keydown', handleKeyDown);
      
      // Set up fullscreen change event listener
      document.addEventListener('fullscreenchange', handleFullscreenChange);
      document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
      document.addEventListener('mozfullscreenchange', handleFullscreenChange);
      document.addEventListener('MSFullscreenChange', handleFullscreenChange);
    });

    // Initialize achievements
    function initializeAchievements() {
      if (achievements.length === 0) {
        achievements = [...achievementDefinitions];
        localStorage.setItem('cyberQuestAchievements', JSON.stringify(achievements));
      }
    }

    // Load user preferences
    function loadUserPreferences() {
      const preferences = JSON.parse(localStorage.getItem('cyberQuestPreferences')) || {};
      soundEnabled = preferences.soundEnabled !== undefined ? preferences.soundEnabled : true;
      musicEnabled = preferences.musicEnabled !== undefined ? preferences.musicEnabled : true;
      
      // Update UI to reflect current state
      updateSoundButton();
      updateMusicButton();
      
      // Start background music if enabled
      if (musicEnabled) {
        const bgMusic = document.getElementById('background-music');
        bgMusic.volume = 0.3;
        bgMusic.play().catch(e => console.log("Audio play failed:", e));
      }
    }

    // Save user preferences
    function saveUserPreferences() {
      const preferences = {
        soundEnabled,
        musicEnabled
      };
      localStorage.setItem('cyberQuestPreferences', JSON.stringify(preferences));
    }

    // Toggle theme
    function toggleTheme() {
      document.body.classList.toggle('light-mode');
      const themeIcon = document.querySelector('#theme-toggle i');
      if (document.body.classList.contains('light-mode')) {
        themeIcon.className = 'fas fa-sun';
      } else {
        themeIcon.className = 'fas fa-moon';
      }
    }

    // Toggle sound
    function toggleSound() {
      soundEnabled = !soundEnabled;
      updateSoundButton();
      saveUserPreferences();
    }

    // Update sound button icon
    function updateSoundButton() {
      const soundIcon = document.querySelector('#sound-toggle i');
      soundIcon.className = soundEnabled ? 'fas fa-volume-up' : 'fas fa-volume-mute';
    }

    // Toggle music
    function toggleMusic() {
      musicEnabled = !musicEnabled;
      updateMusicButton();
      
      const bgMusic = document.getElementById('background-music');
      if (musicEnabled) {
        bgMusic.play().catch(e => console.log("Audio play failed:", e));
      } else {
        bgMusic.pause();
      }
      
      saveUserPreferences();
    }

    // Update music button icon
    function updateMusicButton() {
      const musicIcon = document.querySelector('#music-toggle i');
      musicIcon.className = musicEnabled ? 'fas fa-music' : 'fas fa-music-slash';
    }

    // Play sound effect
    function playSound(soundId) {
      if (!soundEnabled) return;
      
      const sound = document.getElementById(soundId);
      if (sound) {
        sound.currentTime = 0;
        sound.play().catch(e => console.log("Audio play failed:", e));
      }
    }

    // Validate age input
    function validateAge() {
      const ageInput = document.getElementById('player-age');
      const ageError = document.getElementById('age-error');
      const age = parseInt(ageInput.value);
      
      if (isNaN(age) || age < 15 || age > 100) {
        ageError.style.display = 'block';
        return false;
      } else {
        ageError.style.display = 'none';
        return true;
      }
    }

    // Validate phone input
    function validatePhone() {
      const phoneInput = document.getElementById('player-phone');
      const phoneError = document.getElementById('phone-error');
      const phone = phoneInput.value.replace(/\D/g, '');
      
      if (phone.length !== 10) {
        phoneError.style.display = 'block';
        return false;
      } else {
        phoneError.style.display = 'none';
        return true;
      }
    }

    // Validate name input
    function validateName() {
      const nameInput = document.getElementById('player-name');
      const nameError = document.getElementById('name-error');
      
      if (!nameInput.value.trim()) {
        nameError.style.display = 'block';
        return false;
      } else {
        nameError.style.display = 'none';
        return true;
      }
    }

    // Update leaderboard display
    function updateLeaderboard() {
      const leaderboardList = document.getElementById('leaderboard-list');
      leaderboardList.innerHTML = '';
      
      if (leaderboard.length === 0) {
        leaderboardList.innerHTML = '<div class="empty-leaderboard">No agent data available. Be the first to complete the mission!</div>';
        return;
      }
      
      // Sort leaderboard by score (descending)
      const sortedLeaderboard = [...leaderboard].sort((a, b) => b.score - a.score);
      
      sortedLeaderboard.forEach((player, index) => {
        const item = document.createElement('div');
        item.className = 'leaderboard-item';
        if (player.name === playerName) {
          item.classList.add('current-player');
        }
        item.innerHTML = `
          <div class="rank">${index + 1}</div>
          <div class="name">${player.name}</div>
          <div class="score">${player.score}/15</div>
        `;
        leaderboardList.appendChild(item);
      });
    }

    function resetLeaderboard() {
      if (confirm("Are you sure you want to purge all agent data? All mission records will be deleted.")) {
        leaderboard = [];
        localStorage.setItem('phishingQuizLeaderboard', JSON.stringify(leaderboard));
        updateLeaderboard();
      }
    }

    function addToLeaderboard(name, score) {
      // Check if player already exists
      const existingPlayerIndex = leaderboard.findIndex(player => player.name === name);
      
      if (existingPlayerIndex !== -1) {
        // Update score if it's higher
        if (score > leaderboard[existingPlayerIndex].score) {
          leaderboard[existingPlayerIndex].score = score;
        }
      } else {
        // Add new player
        leaderboard.push({ name, score });
      }
      
      // Save to localStorage
      localStorage.setItem('phishingQuizLeaderboard', JSON.stringify(leaderboard));
      updateLeaderboard();
    }

    function getPlayerRanking(name) {
      if (leaderboard.length === 0) return { rank: 1, total: 0 };
      
      // Sort leaderboard by score (descending)
      const sortedLeaderboard = [...leaderboard].sort((a, b) => b.score - a.score);
      
      // Find player's rank
      const rank = sortedLeaderboard.findIndex(player => player.name === name) + 1;
      
      return {
        rank: rank > 0 ? rank : sortedLeaderboard.length + 1,
        total: sortedLeaderboard.length
      };
    }

    function showScreen(screenId) {
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      document.getElementById(screenId).classList.add('active');
      
      // Show/hide leaderboard based on screen
      const leaderboard = document.getElementById('leaderboard');
      if (screenId === 'start-screen') {
        leaderboard.style.display = 'flex';
      } else {
        leaderboard.style.display = 'none';
      }
    }

    function startQuiz() {
      // Validate inputs
      if (!validateName() || !validateAge() || !validatePhone()) {
        return;
      }
      
      const nameInput = document.getElementById("player-name");
      const ageInput = document.getElementById("player-age");
      const phoneInput = document.getElementById("player-phone");
      
      playerName = nameInput.value.trim();
      playerAge = ageInput.value.trim();
      playerPhone = phoneInput.value.replace(/\D/g, '');
      
      // Store user data in JSON format
      userData = {
        name: playerName,
        age: playerAge,
        phone: playerPhone,
        lastPlayed: new Date().toISOString()
      };
      localStorage.setItem('cyberQuestUserData', JSON.stringify(userData));
      
      // Reset game state
      currentRound = 0;
      currentQuestionIndex = 0;
      score = 0;
      roundScores = [0, 0, 0];
      startTime = new Date();
      answerLocked = false;
      
      // Select 5 random questions for each round and shuffle options
      rounds.forEach((round, index) => {
        const roundKey = `round${index + 1}`;
        // Shuffle the question pool for this round
        const shuffledPool = shuffleArray([...questionPool[roundKey]]);
        // Take first 5 questions
        round.questions = shuffledPool.slice(0, 5);
        
        // Shuffle options for each question
        round.questions.forEach(question => {
          // Create an array of option indices
          const optionIndices = question.options.map((_, idx) => idx);
          // Shuffle the indices
          const shuffledIndices = shuffleArray(optionIndices);
          
          // Create new shuffled options array
          const shuffledOptions = shuffledIndices.map(idx => question.options[idx]);
          
          // Find the new index of the correct answer
          const newAnswerIndex = shuffledIndices.indexOf(question.answer);
          
          // Update question with shuffled options and new answer index
          question.options = shuffledOptions;
          question.answer = newAnswerIndex;
        });
      });
      
      updateLeaderboard();
      
      // Enter fullscreen mode
      enterFullscreen();
      
      showRoundIntro();
    }

    // Enter fullscreen mode
    function enterFullscreen() {
      const element = document.documentElement;
      
      if (element.requestFullscreen) {
        element.requestFullscreen();
      } else if (element.mozRequestFullScreen) {
        element.mozRequestFullScreen();
      } else if (element.webkitRequestFullscreen) {
        element.webkitRequestfullscreen();
      } else if (element.msRequestFullscreen) {
        element.msRequestFullscreen();
      }
      
      isInFullscreen = true;
    }

    // Handle fullscreen change events
    function handleFullscreenChange() {
      // Check if we're still in fullscreen
      if (!document.fullscreenElement && !document.webkitFullscreenElement && 
          !document.mozFullScreenElement && !document.msFullscreenElement) {
        isInFullscreen = false;
        
        // Only show the quiz ended screen if we were in the middle of a quiz
        if (currentRound >= 0 && currentQuestionIndex >= 0) {
          showQuizEnded();
        }
      }
    }

    // Show quiz ended screen when fullscreen is exited
    function showQuizEnded() {
      showScreen("quiz-ended-screen");
    }

    function showRoundIntro() {
      const round = rounds[currentRound];
      document.getElementById("round-title").textContent = `Firewall Level ${currentRound + 1}: ${round.title}`;
      document.getElementById("round-description").textContent = round.description;
      
      // Update character speech - guide name is always "Nexus Guardian"
      document.getElementById("round-intro-message").textContent = 
        characterMessages.roundIntro[currentRound];
      
      // Update character image
      document.getElementById("round-intro-character-image").src = agentPhotos[`round${currentRound + 1}`];
      
      // Update progress
      const progress = (currentRound / rounds.length) * 100;
      document.getElementById("overall-progress").style.width = `${progress}%`;
      document.getElementById("progress-text").textContent = `${Math.round(progress)}%`;
      
      // Update round indicator dots
      document.querySelectorAll('.round-dot').forEach((dot, index) => {
        dot.classList.remove('active', 'completed');
        if (index === currentRound) {
          dot.classList.add('active');
        } else if (index < currentRound) {
          dot.classList.add('completed');
        }
      });
      
      showScreen("round-intro-screen");
    }

    function startRound() {
      currentQuestionIndex = 0;
      showQuestion();
      showScreen("quiz-screen");
    }

    function showQuestion() {
      const round = rounds[currentRound];
      const question = round.questions[currentQuestionIndex];
      
      // Update character speech - guide name is always "Nexus Guardian"
      document.getElementById("quiz-message").textContent = 
        characterMessages.quiz[currentRound];
      
      // Update character image
      document.getElementById("quiz-character-image").src = agentPhotos[`round${currentRound + 1}`];
      
      // Update UI elements
      document.getElementById("current-round").textContent = currentRound + 1;
      document.getElementById("current-question").textContent = currentQuestionIndex + 1;
      document.getElementById("current-score").textContent = score;
      
      // Update progress bar
      const progress = ((currentQuestionIndex) / round.questions.length) * 100;
      document.getElementById("question-progress").style.width = `${progress}%`;
      
      // Set question and options
      document.getElementById("question-text").textContent = question.question;
      const optionsDiv = document.getElementById("options");
      optionsDiv.innerHTML = "";
      
      question.options.forEach((opt, index) => {
        const btn = document.createElement("button");
        
        // Check if this is an image option
        if (typeof opt === 'object' && opt.image) {
          // Image-only option
          btn.className = "option-btn image-only";
          btn.innerHTML = `<img src="${opt.image}" class="option-img">`;
        } else {
          // Text option
          btn.className = "option-btn";
          
          // Add number indicator for keyboard navigation
          const numberIndicator = document.createElement("span");
          numberIndicator.className = "option-number";
          numberIndicator.textContent = `${index + 1}`;
          numberIndicator.style.cssText = `
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
          `;
          
          btn.textContent = opt;
          btn.appendChild(numberIndicator);
        }
        
        btn.onclick = () => checkAnswer(index);
        optionsDiv.appendChild(btn);
      });
      
      // Reset feedback and disable next button
      document.getElementById("feedback").textContent = "";
      document.getElementById("feedback").className = "feedback";
      document.getElementById("next-btn").disabled = true;
      
      // Reset answer lock
      answerLocked = false;
    }

    function checkAnswer(selectedIndex) {
      // Prevent double-answering
      if (answerLocked) return;
      answerLocked = true;
      
      const round = rounds[currentRound];
      const question = round.questions[currentQuestionIndex];
      const feedback = document.getElementById("feedback");
      
      // Disable all option buttons
      document.querySelectorAll('.option-btn').forEach(btn => {
        btn.disabled = true;
      });
      
      if (selectedIndex === question.answer) {
        feedback.textContent = `✅ Security Protocol Confirmed! ${question.explanation}`;
        feedback.className = "feedback correct";
        score++;
        roundScores[currentRound]++;
        
        // Play correct sound
        playSound('correct-sound');
        
        // Update character speech for correct answer
        const randomIndex = Math.floor(Math.random() * characterMessages.correctAnswer.length);
        document.getElementById("quiz-message").textContent = 
          characterMessages.correctAnswer[randomIndex];
      } else {
        feedback.textContent = `❌ Security Breach Detected! ${question.explanation}`;
        feedback.className = "feedback incorrect";
        
        // Play incorrect sound
        playSound('incorrect-sound');
        
        // Update character speech for incorrect answer
        const randomIndex = Math.floor(Math.random() * characterMessages.incorrectAnswer.length);
        document.getElementById("quiz-message").textContent = 
          characterMessages.incorrectAnswer[randomIndex];
      }
      
      // Enable next button
      document.getElementById("next-btn").disabled = false;
      
      // Auto-proceed to next question after a delay
      setTimeout(() => {
        if (document.getElementById("quiz-screen").classList.contains("active")) {
          nextQuestion();
        }
      }, 1500);
    }

    function nextQuestion() {
      const round = rounds[currentRound];
      currentQuestionIndex++;
      
      if (currentQuestionIndex < round.questions.length) {
        showQuestion();
      } else {
        showRoundComplete();
      }
    }

    function showRoundComplete() {
      const roundScore = roundScores[currentRound];
      document.getElementById("completed-round").textContent = currentRound + 1;
      document.getElementById("round-score-value").textContent = roundScore;
      
      // Update character speech - guide name is always "Nexus Guardian"
      document.getElementById("round-complete-message").textContent = 
        characterMessages.roundComplete[currentRound];
      
      // Update character image
      document.getElementById("round-complete-character-image").src = agentPhotos[`round${currentRound + 1}`];
      
      let resultTitle = "";
      let feedback = "";
      
      if (roundScore === 5) {
        resultTitle = "Firewall Integrity: Optimal!";
        feedback = "Excellent work! You've mastered this security level.";
        
        // Check for first round master achievement
        checkAchievement("first_round_master");
      } else if (roundScore >= 3) {
        resultTitle = "Firewall Integrity: Stable";
        feedback = "You performed well, but there's room for improvement.";
      } else {
        resultTitle = "Firewall Integrity: Compromised";
        feedback = "Review the security protocols and try again for better results.";
      }
      
      document.getElementById("round-result-title").textContent = resultTitle;
      document.getElementById("round-feedback").textContent = feedback;
      
      // Play level complete sound only if player passed the round
      if (roundScore >= 4) {
        playSound('level-complete-sound');
        
        // Show celebration for good scores
        triggerConfetti();
      }
      
      // MODIFIED: Always proceed to next round regardless of score
      if (currentRound < rounds.length - 1) {
        // Show countdown to next round
        document.getElementById("auto-proceed-message").style.display = "block";
        startCountdown();
      } else {
        // This is the last round, end the quiz
        setTimeout(() => {
          addToLeaderboard(playerName, score);
          endQuiz();
        }, 1000);
      }
      
      showScreen("round-complete-screen");
    }

    function startCountdown() {
      let countdown = 3;
      const countdownElement = document.getElementById("countdown");
      countdownElement.textContent = countdown;
      
      clearInterval(countdownInterval);
      countdownInterval = setInterval(() => {
        countdown--;
        countdownElement.textContent = countdown;
        
        if (countdown <= 0) {
          clearInterval(countdownInterval);
          nextRound();
        }
      }, 1000);
    }

    function nextRound() {
      currentRound++;
      
      if (currentRound < rounds.length) {
        showRoundIntro();
      } else {
        // Calculate completion time
        const endTime = new Date();
        const completionTime = Math.floor((endTime - startTime) / 1000); // in seconds
        
        // Check for fast finisher achievement
        if (completionTime < 180) { // Under 3 minutes
          checkAchievement("fast_finisher");
        }
        
        // Check for cyber expert achievement
        checkAchievement("cyber_expert");
        
        // Check for perfect score achievement
        if (score === 15) {
          checkAchievement("perfect_score");
        }
        
        addToLeaderboard(playerName, score);
        endQuiz();
      }
    }

    function showGameOver() {
      document.getElementById("final-score-go").textContent = score;
      
      // Play game over sound only when player loses
      playSound('game-over-sound');
      
      showScreen("game-over-screen");
    }

    function endQuiz() {
      const finalScore = score;
      document.getElementById("congrats-message").textContent = `🎉 Mission Complete, Agent ${playerName}!`;
      document.getElementById("final-score-value").textContent = finalScore;
      
      // Update round scores
      document.getElementById("round1-score").textContent = roundScores[0];
      document.getElementById("round2-score").textContent = roundScores[1];
      document.getElementById("round3-score").textContent = roundScores[2];
      
      // Update player ranking
      const ranking = getPlayerRanking(playerName);
      document.getElementById("ranking-badge").textContent = `#${ranking.rank}`;
      document.getElementById("total-players").textContent = ranking.total;
      
      // Show achievements
      displayAchievements();
      
      const celebration = document.getElementById("celebration");
      if (finalScore >= 13) {
        celebration.textContent = "🏆 Elite Cyber Agent Status Achieved!";
        document.getElementById("trophy").style.animation = "bounce 1s infinite";
        
        // Trigger celebration effects
        triggerConfetti();
        playSound('game-complete-sound');
      } else if (finalScore >= 8) {
        celebration.textContent = "👏 Field Agent - Maintain Vigilance!";
        triggerConfetti();
        playSound('game-complete-sound');
      } else {
        celebration.textContent = "💡 Rookie Agent - Continue Training!";
         triggerConfetti();
        playSound('game-complete-sound'); 
        
      }
      
      showScreen("end-screen");
    }

    function restartQuiz() {
      // Reset input fields
      document.getElementById("player-name").value = "";
      document.getElementById("player-age").value = "";
      document.getElementById("player-phone").value = "";
      
      showScreen("start-screen");
    }

    // Shuffle function
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // Trigger confetti effect
    function triggerConfetti() {
      const confettiCanvas = document.getElementById('confetti-canvas');
      const myConfetti = confetti.create(confettiCanvas, {
        resize: true,
        useWorker: true
      });
      
      myConfetti({
        particleCount: 150,
        spread: 70,
        origin: { y: 0.6 },
        colors: ['#00d9ff', '#ff2a6d', '#05d9e8', '#00ff9d', '#7122fa']
      });
    }

    // 🎇 Firework / Cracker Burst Effect - NEW FUNCTION
    function fireConfetti() {
      const canvas = document.getElementById("confetti-canvas");
      const ctx = canvas.getContext("2d");
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      const colors = ['#ff4b5c', '#ffcc00', '#00c9a7', '#007bff', '#ff6b81'];
      const particles = [];
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;

      for (let i = 0; i < 150; i++) {
        const angle = Math.random() * 2 * Math.PI;
        const speed = Math.random() * 7 + 3;
        particles.push({
          x: centerX,
          y: centerY,
          size: Math.random() * 6 + 3,
          color: colors[Math.floor(Math.random() * colors.length)],
          speedX: Math.cos(angle) * speed,
          speedY: Math.sin(angle) * speed,
          life: 80 + Math.random() * 30,
        });
      }

      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        particles.forEach((p, index) => {
          p.x += p.speedX;
          p.y += p.speedY;
          p.speedY += 0.08; // gravity
          p.life--;
          p.size *= 0.97;

          ctx.fillStyle = p.color;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.size, 0, 2 * Math.PI);
          ctx.fill();

          if (p.life <= 0) particles.splice(index, 1);
        });

        if (particles.length > 0) requestAnimationFrame(animate);
        else ctx.clearRect(0, 0, canvas.width, canvas.height);
      }

      animate();
    }

    // ✅ Check and award achievements (UPDATED with fireConfetti)
    function checkAchievement(achievementId) {
      const achievement = achievements.find(a => a.id === achievementId);
      if (achievement && !achievement.earned) {
        achievement.earned = true;
        achievement.earnedDate = new Date().toISOString();
        localStorage.setItem('cyberQuestAchievements', JSON.stringify(achievements));

        showAchievementNotification(achievement);
        fireConfetti(); // 🎆 Trigger fireworks when achievement unlocked

        return true;
      }
      return false;
    }

    // ✅ Show achievement notification (UPDATED)
    function showAchievementNotification(achievement) {
      const achievementsContainer = document.getElementById('achievements-earned');
      if (achievementsContainer) {
        const badge = document.createElement('div');
        badge.className = 'achievement-badge';
        badge.textContent = `🏆 ${achievement.name}`;
        badge.style.animation = 'achievementPopIn 0.5s ease';
        achievementsContainer.appendChild(badge);

        // Auto-remove notification after few seconds
        setTimeout(() => badge.remove(), 4000);
      }
    }

    // ✅ Display all earned achievements (UPDATED)
    function displayAchievements() {
      const achievementsContainer = document.getElementById('achievements-container');
      if (!achievementsContainer) return;

      achievementsContainer.innerHTML = '<h3>Your Achievements</h3>';
      const earnedAchievements = achievements.filter(a => a.earned);

      if (earnedAchievements.length === 0) {
        achievementsContainer.innerHTML += '<p>No achievements earned yet. Keep playing to earn badges!</p>';
        return;
      }

      earnedAchievements.forEach(achievement => {
        const badge = document.createElement('div');
        badge.className = 'achievement-badge';
        badge.textContent = `${achievement.name}`;
        badge.title = achievement.description;
        achievementsContainer.appendChild(badge);
      });
    }

    // Handle keyboard input
    function handleKeyDown(event) {
      // Check if we're on the start screen
      if (document.getElementById("start-screen").classList.contains("active")) {
        // Enter key starts the quiz
        if (event.key === "Enter") {
          startQuiz();
        }
      }
      // Check if we're on the round intro screen
      else if (document.getElementById("round-intro-screen").classList.contains("active")) {
        // Enter key starts the round
        if (event.key === "Enter") {
          startRound();
        }
      }
      // Check if we're on the quiz screen
      else if (document.getElementById("quiz-screen").classList.contains("active")) {
        // Number keys 1-4 select answers
        if (event.key >= "1" && event.key <= "4") {
          const optionIndex = parseInt(event.key) - 1;
          const options = document.querySelectorAll('.option-btn');
          
          if (optionIndex < options.length && !answerLocked) {
            // Visual feedback for keyboard selection
            options[optionIndex].classList.add('keyboard-selected');
            
            // Remove the visual feedback after a short time
            setTimeout(() => {
              options[optionIndex].classList.remove('keyboard-selected');
            }, 300);
            
            // Select the answer
            checkAnswer(optionIndex);
          }
        }
        // Enter key moves to next question if answer is already selected
        else if (event.key === "Enter" && !document.getElementById("next-btn").disabled) {
          nextQuestion();
        }
      }
      // Check if we're on the game over screen
      else if (document.getElementById("game-over-screen").classList.contains("active")) {
        // Enter key restarts the quiz
        if (event.key === "Enter") {
          restartQuiz();
        }
      }
      // Check if we're on the quiz ended screen
      else if (document.getElementById("quiz-ended-screen").classList.contains("active")) {
        // Enter key returns to start
        if (event.key === "Enter") {
          restartQuiz();
        }
      }
      // Check if we're on the end screen
      else if (document.getElementById("end-screen").classList.contains("active")) {
        // Enter key restarts the quiz
        if (event.key === "Enter") {
          restartQuiz();
        }
      }
    }

    const rounds = [
      {
        title: "Data Stream Analysis",
        description: "Identify phishing emails and suspicious data packets",
        questions: []
      },
      {
        title: "Firewall Penetration",
        description: "Spot fake websites and malicious code injections",
        questions: []
      },
      {
        title: "Security Protocols",
        description: "Test your security knowledge and encryption practices",
        questions: []
      }
    ];

    // Character messages
    const characterMessages = {
      roundIntro: [
        "Prepare to analyze incoming data streams for phishing attempts! Focus on identifying suspicious sender addresses and urgent language.",
        "Excellent work on Level 1! Now let's test your website detection skills. Pay attention to URLs and security indicators.",
        "Final security level! Let's evaluate your overall cybersecurity knowledge. Remember to apply everything you've learned."
      ],
      quiz: [
        "Analyze each data packet carefully and select the correct response. I'll provide tactical feedback!",
        "Maintain focus! Your detection skills are improving with each assessment. Look for subtle clues in each question.",
        "Final security evaluation! Demonstrate your comprehensive cybersecurity knowledge. You're almost there!"
      ],
      roundComplete: [
        "Data stream analysis complete! Let's review your performance. You're building strong cybersecurity instincts.",
        "Firewall level secured! Your detection skills are impressive. You're becoming a formidable digital defender.",
        "All security protocols validated! You're becoming a cybersecurity expert! The digital realm is safer with agents like you."
      ],
      correctAnswer: [
        "Security protocol confirmed! Your analysis is accurate. You correctly identified the phishing attempt.",
        "Threat neutralized! You correctly identified that phishing attempt. Your digital instincts are sharp.",
        "Encryption validated! You made the optimal security choice. Keep up the excellent work!"
      ],
      incorrectAnswer: [
        "Security anomaly detected! Let's review the correct protocol. Remember this for future assessments.",
        "Firewall breach! That was a sophisticated attack. Let me explain the defense strategy.",
        "Protocol violation! Let's analyze the correct security approach for this scenario. Learning from mistakes makes you stronger."
      ]
    };
  </script>
</body>
</html>
